import * as React from "react";
import { Stage, Layer, Text, Image } from "react-konva";
import TextLayer from "./TextLayer";
import useImage from "use-image";

const CANVAS_WIDTH = 500;
const CANVAS_HEIGHT = 500;
const BobaCanvas = (props: { text: string; fontSize: number }) => {
  const [image] = useImage("/bobaexploitable.png");
  const [textLayer, setTextLayer] = React.useState({
    top_x: 79,
    top_y: 244,
    bottom_x: 343,
    bottom_y: 418,
    rotation: 7,
    align: "center",
    fragments: [
      { displayText: props.text, color: "black", size: props.fontSize || 70 },
    ],
  });

  const currentText = props.text;
  const currentFontSize = props.fontSize;
  React.useEffect(() => {
    setTextLayer({
      ...textLayer,
      fragments: [
        {
          ...textLayer.fragments[0],
          displayText: currentText,
          size: currentFontSize,
        },
      ],
    });
  }, [currentText, currentFontSize]);
  return (
    <Stage width={CANVAS_WIDTH} height={CANVAS_HEIGHT}>
      {image && (
        <Layer>
          <Image image={image} height={CANVAS_HEIGHT} width={CANVAS_WIDTH} />
        </Layer>
      )}
      <TextLayer
        text={textLayer}
        id="x"
        // selected
        updateTextLayer={(id, layer) => setTextLayer(layer)}
      />
    </Stage>
  );
};

export default BobaCanvas;
